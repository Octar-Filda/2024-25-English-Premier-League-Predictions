<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPL 2024/25 Prediction Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            text-align: center;
        }
        #team-list {
            list-style-type: none;
            padding: 0;
        }
        .team-item {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            margin-bottom: 5px;
            padding: 10px;
            cursor: move;
        }
        .team-item:hover {
            background-color: #e0e0e0;
        }
        .dragging {
            opacity: 0.5;
        }
        .prediction-input {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 5px;
        }
        .goal-challenge {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .goal-challenge input {
            width: 18%;
            padding: 5px;
        }
        button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
        }
        #results {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .formation {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
            background-color: #90EE90;
            padding: 20px;
            border-radius: 10px;
        }
        .formation-row {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-around;
        }
        .formation-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 120px;
        }
        .formation-input input {
            width: 100%;
            padding: 5px;
            margin-bottom: 5px;
        }
        .captain-select {
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>EPL 2024/25 Prediction Game</h1>
    <form id="prediction-form">
        <h2>Your Information</h2>
        <label for="name">Your Name:</label>
        <input type="text" id="name" name="name" class="prediction-input" required>
        
        <h2>Rank the teams:</h2>
        <p>Drag to predict the final standings:</p>
        <ol id="team-list"></ol>
        
        <h2>Additional Predictions:</h2>
        <label for="son-goals">How many goals will Son Heung Min score this season?</label>
        <input type="number" id="son-goals" name="son_goals" class="prediction-input" required min="0">
        
        <label for="hwang-goals">How many goals will Hwang Hee Chan score this season?</label>
        <input type="number" id="hwang-goals" name="hwang_goals" class="prediction-input" required min="0">
        
        <label>25골 챌린지 : 각각 다른팀에서 총 5명을 선발하여 득점 합계가 25가 되거나 가장 가깝게 맞추기.</label>
        <div class="goal-challenge">
            <input type="text" name="goal_challenge1" required>
            <input type="text" name="goal_challenge2" required>
            <input type="text" name="goal_challenge3" required>
            <input type="text" name="goal_challenge4" required>
            <input type="text" name="goal_challenge5" required>
        </div>
        
        <h3>시즌 평점 Best XI (팀 중복 불가)</h3>
        <p>Select one player as captain by checking the box next to their name.</p>
        <div class="formation">
            <div class="formation-row">
                <div class="formation-input">
                    <input type="text" name="left_wing" placeholder="Left Wing">
                    <input type="text" name="left_wing_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="left_wing" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="striker" placeholder="Striker">
                    <input type="text" name="striker_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="striker" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="right_wing" placeholder="Right Wing">
                    <input type="text" name="right_wing_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="right_wing" class="captain-select">
                </div>
            </div>
            <div class="formation-row">
                <div class="formation-input">
                    <input type="text" name="left_mid" placeholder="Left Midfielder">
                    <input type="text" name="left_mid_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="left_mid" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="center_mid" placeholder="Center Midfielder">
                    <input type="text" name="center_mid_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="center_mid" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="right_mid" placeholder="Right Midfielder">
                    <input type="text" name="right_mid_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="right_mid" class="captain-select">
                </div>
            </div>
            <div class="formation-row">
                <div class="formation-input">
                    <input type="text" name="left_back" placeholder="Left Back">
                    <input type="text" name="left_back_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="left_back" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="center_back1" placeholder="Center Back">
                    <input type="text" name="center_back1_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="center_back1" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="center_back2" placeholder="Center Back">
                    <input type="text" name="center_back2_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="center_back2" class="captain-select">
                </div>
                <div class="formation-input">
                    <input type="text" name="right_back" placeholder="Right Back">
                    <input type="text" name="right_back_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="right_back" class="captain-select">
                </div>
            </div>
            <div class="formation-row">
                <div class="formation-input">
                    <input type="text" name="goalkeeper" placeholder="Goalkeeper">
                    <input type="text" name="goalkeeper_team" placeholder="Team">
                    <input type="checkbox" name="captain" value="goalkeeper" class="captain-select">
                </div>
            </div>
        </div>
        
        <button type="submit">Submit Predictions</button>
    </form>
    <div id="results"></div>

    <script>
        const teams = [
            "Arsenal", "Aston Villa", "Bournemouth", "Brentford", "Brighton", 
            "Chelsea", "Crystal Palace", "Everton", "Fulham", 
            "Ipswich Town", "Leicester City", "Liverpool", "Manchester City", "Manchester United", 
            "Newcastle United", "Nottingham Forest", "Southampton", "Tottenham Hotspur", 
            "West Ham United", "Wolverhampton Wanderers"
        ];

        // Sort teams alphabetically
        teams.sort();

        const teamList = document.getElementById('team-list');

        teams.forEach((team) => {
            const li = document.createElement('li');
            li.className = 'team-item';
            li.draggable = true;
            li.textContent = team;
            teamList.appendChild(li);
        });

        teamList.addEventListener('dragstart', (e) => {
            e.target.classList.add('dragging');
        });

        teamList.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
        });

        teamList.addEventListener('dragover', (e) => {
            e.preventDefault();
            const afterElement = getDragAfterElement(teamList, e.clientY);
            const draggable = document.querySelector('.dragging');
            if (afterElement == null) {
                teamList.appendChild(draggable);
            } else {
                teamList.insertBefore(draggable, afterElement);
            }
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.team-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Ensure only one captain is selected
        const captainSelects = document.querySelectorAll('.captain-select');
        captainSelects.forEach(select => {
            select.addEventListener('change', function() {
                if (this.checked) {
                    captainSelects.forEach(otherSelect => {
                        if (otherSelect !== this) otherSelect.checked = false;
                    });
                }
            });
        });

        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent form from submitting
            const predictions = Array.from(document.querySelectorAll('.team-item')).map((item, index) => ({
                team: item.textContent,
                position: index + 1
            }));
            
            // Display results
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>Your Predictions:</h2>';
            resultsDiv.innerHTML += `<p><strong>Name:</strong> ${document.getElementById('name').value}</p>`;
            resultsDiv.innerHTML += '<h3>Final Standings:</h3>';
            resultsDiv.innerHTML += '<ol>' + predictions.map(p => `<li>${p.team}</li>`).join('') + '</ol>';
            resultsDiv.innerHTML += `<h3>Additional Predictions:</h3>`;
            resultsDiv.innerHTML += `<p>Son Heung Min's goals: ${document.getElementById('son-goals').value}</p>`;
            resultsDiv.innerHTML += `<p>Hwang Hee Chan's goals: ${document.getElementById('hwang-goals').value}</p>`;
            
            resultsDiv.innerHTML += '<p>25골 챌린지: ';
            for (let i = 1; i <= 5; i++) {
                resultsDiv.innerHTML += document.getElementsByName(`goal_challenge${i}`)[0].value;
                if (i < 5) resultsDiv.innerHTML += ', ';
            }
            resultsDiv.innerHTML += '</p>';
            
            resultsDiv.innerHTML += '<h3>시즌 평점 Best XI:</h3>';
            const formationInputs = document.querySelectorAll('.formation-input');
            const bestXI = Array.from(formationInputs).map(input => {
                const player = input.querySelector('input:first-of-type').value;
                const team = input.querySelector('input:nth-of-type(2)').value;
                const isCaptain = input.querySelector('.captain-select').checked;
                return `${player} (${team})${isCaptain ? ' (C)' : ''}`;
            });
            resultsDiv.innerHTML += '<ul>' + bestXI.map(player => `<li>${player}</li>`).join('') + '</ul>';
            
            resultsDiv.innerHTML += '<h3>위 답안을 캡쳐해서 이필립한테 보내시오</h3>';
        });
    </script>
</body>
</html>
